import{a as V,c as L,f as R,g as Y}from"./chunk-JGMNXGSB.js";import{a as T}from"./chunk-36OP2RTB.js";import{a as j,b as M,c as z,d as B,f as A,g as G,i as q,j as H,l as $}from"./chunk-YOXO25BK.js";import{U as F}from"./chunk-HRFT26DT.js";import{$ as m,G as P,H as O,I as N,J as S,Va as D,W as I,Y as n,Ya as U,ba as k,e as x,ja as p,la as g,oa as w,pa as a,qa as i,ra as _,sa as y,ta as b,ua as f,va as E,wa as C,xa as l,ya as h,za as v}from"./chunk-Q5M72QWD.js";function Q(o,r){if(o&1&&(a(0,"p",8),l(1),i()),o&2){let t=f();n(),h(t.locationNameErrorMessage)}}function X(o,r){if(o&1&&(a(0,"p",8),l(1),i()),o&2){let t=f();n(),h(t.descriptionErrorMessage)}}function Z(o,r){if(o&1){let t=y();a(0,"button",24),b("click",function(){P(t);let s=f(),c=E(20);return O(s.clearFile(c))}),l(1," Clear "),i()}}function ee(o,r){if(o&1&&(a(0,"p",8),l(1),i()),o&2){let t=f();n(),h(t.fileError)}}function te(o,r){if(o&1&&(a(0,"div",20),_(1,"img",25),i()),o&2){let t=f();n(),w("src",t.previewUrl,I)}}function ne(o,r){if(o&1&&(a(0,"p",21),l(1),i()),o&2){let t=f();n(),v("Uploading\u2026 ",t.uploadProgress,"%")}}var W=class o{constructor(r,t,e,s,c,d){this.formBuilder=r;this.destinationService=t;this.router=e;this.authService=s;this.title=c;this.storage=d;this.profile=this.authService.profileSignal,this.form=this.formBuilder.group({locationName:["",[M.required,M.minLength(4)]],description:["",[M.required,M.minLength(10)]]})}form;profile;selectedFile=null;previewUrl=null;uploading=!1;uploadProgress=0;fileError=null;ngOnInit(){this.title.setTitle("New Destination")}get locationName(){return this.form.get("locationName")}get description(){return this.form.get("description")}get isLocationNameNotValid(){return this.locationName?.invalid&&(this.locationName?.dirty||this.locationName?.touched)||!1}get isDescriptionNotValid(){return this.description?.invalid&&(this.description?.dirty||this.description?.touched)||!1}get locationNameErrorMessage(){return this.locationName?.errors?.required?"Location name is required!":this.locationName?.errors?.minlength?"Minimum of 4 characters!":""}get descriptionErrorMessage(){return this.description?.errors?.required?"Description is required!":this.description?.errors?.minlength?"Minimum of 10 characters!":""}onFileSelected(r){this.fileError=null;let e=r.target.files?.[0]??null;if(!e){this.selectedFile=null,this.previewUrl&&URL.revokeObjectURL(this.previewUrl),this.previewUrl=null;return}if(!e.type.startsWith("image/")){this.fileError="Please select an image file.";return}let s=5;if(e.size>s*1024*1024){this.fileError=`Image must be \u2264 ${s}MB.`;return}this.selectedFile=e,this.previewUrl&&URL.revokeObjectURL(this.previewUrl),this.previewUrl=URL.createObjectURL(e)}uploadImageOrThrow(r){return x(this,null,function*(){if(!this.selectedFile)throw new Error("Please select an image.");let t=this.selectedFile,e=`destinations/${r}/${Date.now()}_${t.name.replace(/\s+/g,"_")}`,s=R(this.storage,e);this.uploading=!0,this.uploadProgress=0;let c=Y(s,t,{contentType:t.type});yield new Promise((J,K)=>{c.on("state_changed",u=>{u.totalBytes&&(this.uploadProgress=Math.round(u.bytesTransferred/u.totalBytes*100))},u=>K(u),()=>J())});let d=yield L(s);return this.uploading=!1,{url:d,path:e}})}onSubmit(){return x(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched();return}let r=this.profile();if(!r){console.error("No logged-in user");return}try{let{url:t,path:e}=yield this.uploadImageOrThrow(r.uid),s=this.form.getRawValue(),c={locationName:s.locationName,description:s.description,imgUrl:t,authorId:r.uid,authorName:r.displayName,storagePath:e};this.destinationService.addDestination(c).subscribe({next:d=>this.router.navigate(["/destinations",d.id],{replaceUrl:!0}),error:d=>alert("Failed to add destination: "+(d?.message??"Unknown error"))})}catch(t){this.uploading=!1,alert("Image upload failed: "+(t?.message??"Unknown error"))}})}clearFile(r){this.previewUrl&&URL.revokeObjectURL(this.previewUrl),this.previewUrl=null,this.selectedFile=null,this.fileError=null,r.value=""}static \u0275fac=function(t){return new(t||o)(m(H),m(T),m(U),m(F),m(D),m(V))};static \u0275cmp=k({type:o,selectors:[["app-new-destination"]],decls:35,vars:19,consts:[["fileInput",""],[1,"new-destination","card","outer-container","form-card"],[1,"inner-container"],[1,"form-title"],[1,"form-grid",3,"ngSubmit","formGroup"],[1,"form-group"],["for","locationName"],["type","text","id","locationName","formControlName","locationName","placeholder","e.g. Paris"],[1,"error"],[1,"form-group","span-2"],["for","description"],["id","description","formControlName","description","placeholder","Say something about this place...","rows","6"],["for","image"],[1,"file-picker"],["id","image","type","file","accept","image/*",1,"file-input",3,"change"],["for","image",1,"file-btn"],["viewBox","0 0 24 24","width","16","height","16","aria-hidden","true"],["d","M19 13v6H5v-6H3v8h18v-8h-2zM11 3h2v8h3l-4 4-4-4h3V3z","fill","currentColor"],[1,"file-name"],["type","button",1,"file-clear"],[2,"margin-top",".5rem"],[1,"muted"],[1,"actions"],["type","submit",1,"btn-accent",3,"disabled"],["type","button",1,"file-clear",3,"click"],["alt","Preview",2,"max-width","100%","border-radius","8px",3,"src"]],template:function(t,e){if(t&1){let s=y();a(0,"div",1)(1,"div",2)(2,"h4",3),l(3,"Add New Destination"),i(),a(4,"form",4),b("ngSubmit",function(){return P(s),O(e.onSubmit())}),a(5,"div",5)(6,"label",6),l(7,"Location Name"),i(),_(8,"input",7),p(9,Q,2,1,"p",8),i(),a(10,"div",9)(11,"label",10),l(12,"Describe your exp..."),i(),_(13,"textarea",11),p(14,X,2,1,"p",8),i(),a(15,"div",9)(16,"label",12),l(17,"Image"),i(),a(18,"div",13)(19,"input",14,0),b("change",function(d){return P(s),O(e.onFileSelected(d))}),i(),a(21,"label",15),N(),a(22,"svg",16),_(23,"path",17),i(),S(),a(24,"span"),l(25),i()(),a(26,"span",18),l(27),i(),p(28,Z,2,0,"button",19),i(),p(29,ee,2,1,"p",8),p(30,te,2,1,"div",20),p(31,ne,2,1,"p",21),i(),a(32,"div",22)(33,"button",23),l(34),i()()()()()}t&2&&(n(4),w("formGroup",e.form),n(4),C("input-error",e.isLocationNameNotValid),n(),g(e.isLocationNameNotValid?9:-1),n(4),C("input-error",e.isDescriptionNotValid),n(),g(e.isDescriptionNotValid?14:-1),n(4),C("error",!!e.fileError||e.uploading&&e.uploadProgress<100),n(7),h(e.selectedFile?"Change image":"Choose image"),n(),C("placeholder",!e.selectedFile),n(),v(" ",e.selectedFile?e.selectedFile.name:"No file chosen"," "),n(),g(e.selectedFile?28:-1),n(),g(e.fileError?29:-1),n(),g(e.previewUrl?30:-1),n(),g(e.uploading?31:-1),n(2),w("disabled",e.form.invalid||e.uploading||!e.selectedFile),n(),v(" ",e.uploading?"Uploading\u2026 "+e.uploadProgress+"%":"Save Destination"," "))},dependencies:[$,A,j,z,B,G,q],styles:['[_ngcontent-%COMP%]:root{--bg-card:#0d1117;--bg-elev:#161b22;--border:#30363d;--text:#c9d1d9;--muted:#8b949e;--accent:#58a6ff;--accent-2:#1f6feb;--danger:#f85149}[_nghost-%COMP%]{display:block;animation:_ngcontent-%COMP%_pageIn .35s ease-out both;will-change:opacity,transform}.new-destination.outer-container[_ngcontent-%COMP%]{margin:0 auto;max-width:min(760px,96vw);padding:2rem 1rem 3rem;display:flex;justify-content:center}.new-destination.form-card[_ngcontent-%COMP%]{width:100%;background:var(--bg-card);border:1px solid var(--border);border:none;animation:_ngcontent-%COMP%_cardIn .38s ease-out .04s both}.new-destination[_ngcontent-%COMP%]   .inner-container[_ngcontent-%COMP%]{padding:1.25rem}.new-destination[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:clamp(1.2rem,.8vw + 1rem,1.6rem);font-weight:700;letter-spacing:.2px;line-height:1.15;color:transparent;background:linear-gradient(180deg,#e8f1ff,#b6d8ff 65%,#7fb6ff);-webkit-background-clip:text;background-clip:text;position:relative;animation:_ngcontent-%COMP%_titleUp .42s ease-out both}.new-destination[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]:after{content:"";display:block;height:2px;width:72px;margin-top:.5rem;background:linear-gradient(90deg,var(--accent),transparent);border-radius:2px;opacity:.95}.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.45rem}.new-destination[_ngcontent-%COMP%]   .span-2[_ngcontent-%COMP%]{grid-column:1 / -1}.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:0;transform:translateY(8px);animation:_ngcontent-%COMP%_fieldIn .42s ease-out both}.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){animation-delay:.06s}.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){animation-delay:.1s}.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(3){animation-delay:.14s}.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(4){animation-delay:.18s}.new-destination[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text);font-size:.9rem}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:var(--bg-elev);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:.65rem .75rem;outline:none;transition:border-color .42s cubic-bezier(.22,.61,.36,1),box-shadow .42s cubic-bezier(.22,.61,.36,1)}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder, .new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:var(--muted)}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{border-color:var(--accent);box-shadow:0 0 0 3px #58a6ff26}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:140px}.new-destination[_ngcontent-%COMP%]   .input-error[_ngcontent-%COMP%]{border-color:#f85149!important;box-shadow:0 0 0 3px #f8514926!important}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input.input-error[_ngcontent-%COMP%]:focus, .new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea.input-error[_ngcontent-%COMP%]:focus{border-color:#f85149!important;box-shadow:0 0 0 3px #f8514926!important}.new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   p.error[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .span-2[_ngcontent-%COMP%]   p.error[_ngcontent-%COMP%]{margin:.25rem 0 0;color:#f85149;font-weight:600;font-style:normal;font-size:.85rem;animation:_ngcontent-%COMP%_errorIn .32s cubic-bezier(.22,.61,.36,1) both}.new-destination[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;justify-content:flex-end;margin-top:.25rem;opacity:0;transform:translateY(8px);animation:_ngcontent-%COMP%_fieldIn .42s ease-out .22s both}.new-destination[_ngcontent-%COMP%]   .btn-accent[_ngcontent-%COMP%]{background:var(--accent-2);border:1px solid #316dca;color:#fff;border-radius:12px;padding:.6rem 1rem;font-weight:600;cursor:pointer}.btn-accent[disabled][_ngcontent-%COMP%]{cursor:not-allowed;opacity:.6}.new-destination[_ngcontent-%COMP%]   .file-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem;background:var(--bg-elev);border:1px solid var(--border);border-radius:12px;padding:.5rem .6rem;opacity:0;transform:translateY(8px);animation:_ngcontent-%COMP%_fieldIn .42s ease-out .14s both}.new-destination[_ngcontent-%COMP%]   .file-picker.error[_ngcontent-%COMP%]{border-color:#f85149;box-shadow:0 0 0 3px #f8514926}.new-destination[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}.new-destination[_ngcontent-%COMP%]   .file-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.4rem;padding:.45rem .7rem;border-radius:999px;background:linear-gradient(180deg,var(--accent,#58a6ff),var(--accent-2,#1f6feb));border:1px solid #316dca;color:#0b1220;font-weight:600;cursor:pointer;transition:transform .06s ease,filter .15s ease;-webkit-user-select:none;user-select:none}.new-destination[_ngcontent-%COMP%]   .file-btn[_ngcontent-%COMP%]:hover{filter:brightness(1.06)}.new-destination[_ngcontent-%COMP%]   .file-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.new-destination[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{flex:1;min-width:0;color:var(--muted);padding:.25rem .4rem;border-radius:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border:1px solid var(--border);background:#ffffff0a}.new-destination[_ngcontent-%COMP%]   .file-name.placeholder[_ngcontent-%COMP%]{opacity:.8}.new-destination[_ngcontent-%COMP%]   .file-clear[_ngcontent-%COMP%]{background:transparent;color:var(--muted);border:1px solid var(--border);padding:.35rem .6rem;border-radius:999px;cursor:pointer;transition:background .15s,border-color .15s,color .15s}.new-destination[_ngcontent-%COMP%]   .file-clear[_ngcontent-%COMP%]:hover{background:#11161a;border-color:#3d444d;color:var(--text)}@media (max-width: 720px){.new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@keyframes _ngcontent-%COMP%_pageIn{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_titleUp{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_cardIn{0%{opacity:0;transform:translateY(8px) scale(.99);filter:saturate(.95)}to{opacity:1;transform:translateY(0) scale(1);filter:saturate(1)}}@keyframes _ngcontent-%COMP%_fieldIn{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_errorIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}@media (prefers-reduced-motion: reduce){[_nghost-%COMP%], .new-destination.form-card[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .file-picker[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%], .new-destination[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   p.error[_ngcontent-%COMP%]{animation:none!important;transform:none!important;opacity:1!important}}']})};export{W as NewDestination};
